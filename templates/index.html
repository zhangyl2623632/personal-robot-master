<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººæ™ºèƒ½é—®ç­”æœºå™¨äºº</title>
    <link rel="stylesheet" href="/static/style.css">
    <!-- ä¼˜å…ˆåŠ è½½ jsDelivr çš„ markedï¼Œè‹¥åŠ è½½å¤±è´¥åˆ™åœ¨åç»­è„šæœ¬ä¸­è¿›è¡Œå›é€€ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // å¦‚æœä¸»CDNä¸å¯ç”¨ï¼Œå°è¯•å…¶å®ƒCDNï¼›è‹¥å…¨éƒ¨å¤±è´¥åˆ™é™çº§ä¸ºçº¯æ–‡æœ¬æ¸²æŸ“
        (function ensureMarked() {
            function loadFallback(src, onload) {
                var s = document.createElement('script');
                s.src = src;
                s.onload = onload;
                s.onerror = function() {
                    console.warn('å¤‡ç”¨CDNåŠ è½½å¤±è´¥: ' + src);
                };
                document.head.appendChild(s);
            }
            function ensure() {
                if (window.marked && typeof window.marked.parse === 'function') {
                    console.info('marked å·²å¯ç”¨');
                    return;
                }
                console.warn('ä¸»CDNä¸å¯ç”¨ï¼Œå°è¯•å¤‡ç”¨CDNåŠ è½½ marked');
                // ä¾æ¬¡å°è¯• unpkg å’Œ cdnjs
                loadFallback('https://unpkg.com/marked@4.3.0/marked.min.js', function() {
                    if (!(window.marked && typeof window.marked.parse === 'function')) {
                        loadFallback('https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js', function() {
                            if (!(window.marked && typeof window.marked.parse === 'function')) {
                                console.error('æ‰€æœ‰CDNå‡ä¸å¯ç”¨ï¼Œé™çº§ä¸ºçº¯æ–‡æœ¬æ¸²æŸ“');
                                window.marked = { parse: function(txt) { return (txt || '').replace(/</g, '&lt;').replace(/>/g, '&gt;'); } };
                            }
                        });
                    }
                });
            }
            // å»¶è¿Ÿå°‘è®¸ä»¥ç­‰å¾…ä¸»CDNæ³¨å…¥
            setTimeout(ensure, 500);
        })();
    </script>
    <script src="/static/script.js"></script>

</head>
<body>
    <div class="container">
        <header>
            <h1>ä¸ªäººæ™ºèƒ½é—®ç­”æœºå™¨äºº</h1>
            <p>åŸºäºæœ¬åœ°æ–‡æ¡£çš„æ™ºèƒ½é—®ç­”ç³»ç»Ÿ</p>
        </header>

        <main>
            <!-- åŠŸèƒ½åˆ‡æ¢é€‰é¡¹å¡ -->
            <div class="tabs">
                <button id="ask-tab" class="tab-button active" onclick="switchTab('ask')">å•æ¬¡æé—®</button>
                <button id="chat-tab" class="tab-button" onclick="switchTab('chat')">å¯¹è¯æ¨¡å¼</button>
                <button id="upload-tab" class="tab-button" onclick="switchTab('upload')">æ–‡æ¡£ä¸Šä¼ </button>
                <button id="status-tab" class="tab-button" onclick="switchTab('status')">ç³»ç»ŸçŠ¶æ€</button>
            </div>

            <!-- å•æ¬¡æé—®é¢æ¿ -->
            <div id="ask-panel" class="panel active">
                <div class="panel-header">
                    <h2>å•æ¬¡æé—®</h2>
                    <p>ä¸ä¿ç•™å¯¹è¯å†å²çš„å•æ¬¡é—®ç­”</p>
                </div>
                <div class="chat-container">
                    <div id="ask-messages" class="messages"></div>
                    <div class="input-area">
                        <textarea id="ask-input" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..." rows="3"></textarea>
                        <button id="ask-send" onclick="sendAskQuery()">å‘é€</button>
                    </div>
                </div>
            </div>

            <!-- å¯¹è¯æ¨¡å¼é¢æ¿ -->
            <div id="chat-panel" class="panel">
                <div class="panel-header">
                    <h2>å¯¹è¯æ¨¡å¼</h2>
                    <p>ä¿ç•™å¯¹è¯å†å²çš„è¿ç»­é—®ç­”</p>
                    <button id="clear-history" class="secondary-button" onclick="clearChatHistory()">æ¸…ç©ºå†å²</button>
                </div>
                <div class="chat-container">
                    <div id="chat-messages" class="messages"></div>
                    <div class="input-area">
                        <textarea id="chat-input" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..." rows="3"></textarea>
                        <button id="chat-send" onclick="sendChatQuery()">å‘é€</button>
                    </div>
                </div>
            </div>

            <!-- æ–‡æ¡£ä¸Šä¼ é¢æ¿ -->
            <div id="upload-panel" class="panel">
                <div class="panel-header">
                    <h2>æ–‡æ¡£ä¸Šä¼ </h2>
                    <p>ä¸Šä¼ æ–°æ–‡æ¡£å¹¶æ·»åŠ åˆ°å‘é‡å­˜å‚¨</p>
                </div>
                <div class="upload-container">
                    <div class="upload-area">
                        <div id="drop-area" class="drop-zone">
                            <div class="drop-zone-content">
                                <div class="drop-zone-icon">ğŸ“</div>
                                <p>æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                                <input type="file" id="file-input" class="file-input" multiple accept=".txt,.md,.pdf,.docx,.doc,.xlsx,.xls,.csv,.jpg,.jpeg,.png,.gif">
                                <button id="select-file-btn" class="secondary-button" onclick="document.getElementById('file-input').click()">é€‰æ‹©æ–‡ä»¶</button>
                            </div>
                        </div>
                        
                        <div id="file-list" class="file-list">
                            <p>å·²é€‰æ‹©çš„æ–‡ä»¶å°†æ˜¾ç¤ºåœ¨æ­¤å¤„</p>
                        </div>
                        
                        <div class="upload-actions">
                            <button id="upload-btn" class="primary-button" onclick="uploadFiles()">å¼€å§‹ä¸Šä¼ </button>
                            <button id="clear-files-btn" class="secondary-button" onclick="clearFileSelection()">æ¸…ç©ºé€‰æ‹©</button>
                        </div>
                    </div>
                    
                    <div id="upload-status" class="upload-status">
                        <h3>ä¸Šä¼ çŠ¶æ€</h3>
                        <div id="upload-log" class="upload-log"></div>
                    </div>
                </div>
            </div>
            
            <!-- ç³»ç»ŸçŠ¶æ€é¢æ¿ -->
            <div id="status-panel" class="panel">
                <div class="panel-header">
                    <h2>ç³»ç»ŸçŠ¶æ€</h2>
                    <button id="refresh-status" class="secondary-button" onclick="refreshStatus()">åˆ·æ–°</button>
                </div>
                <div class="status-container">
                    <!-- ç³»ç»Ÿæ¦‚è§ˆç»„ -->
                    <div class="status-group">
                        <div class="status-group-header">
                            <span class="status-group-icon">ğŸ“Š</span>
                            <span>ç³»ç»Ÿæ¦‚è§ˆ</span>
                        </div>
                        <div class="status-group-content">
                            <div class="status-item">
                                <span class="status-label">ç³»ç»Ÿç‰ˆæœ¬:</span>
                                <span id="system-version" class="status-value">åŠ è½½ä¸­...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">å½“å‰æ—¶é—´:</span>
                                <span id="current-time" class="status-value">åŠ è½½ä¸­...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- APIçŠ¶æ€ç»„ -->
                    <div class="status-group">
                        <div class="status-group-header">
                            <span class="status-group-icon">ğŸ”‘</span>
                            <span>APIçŠ¶æ€</span>
                        </div>
                        <div class="status-group-content">
                            <div class="status-item">
                                <span class="status-label">é»˜è®¤APIå¯†é’¥çŠ¶æ€:</span>
                                <div id="default-api-key-status" class="status-indicator">
                                    <span class="status-dot"></span>
                                    <span>åŠ è½½ä¸­...</span>
                                </div>
                            </div>
                            <!-- APIå¯†é’¥çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ -->
                            <div id="api-key-status" class="api-key-status-container"></div>
                        </div>
                    </div>
                    
                    <!-- æ–‡æ¡£ä¸å‘é‡å­˜å‚¨ç»„ -->
                    <div class="status-group">
                        <div class="status-group-header">
                            <span class="status-group-icon">ğŸ“š</span>
                            <span>æ–‡æ¡£ä¸å‘é‡å­˜å‚¨</span>
                        </div>
                        <div class="status-group-content">
                            <div class="status-item">
                                <span class="status-label">æ–‡æ¡£ç›®å½•:</span>
                                <span id="documents-path" class="status-value">åŠ è½½ä¸­...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">å‘é‡å­˜å‚¨è·¯å¾„:</span>
                                <span id="vector-store-path" class="status-value">åŠ è½½ä¸­...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">å‘é‡å­˜å‚¨ä¸­æ–‡æ¡£æ•°é‡:</span>
                                <span id="vector-count" class="status-value">åŠ è½½ä¸­...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">å…ƒæ•°æ®è·Ÿè¸ªæ–‡æ¡£æ•°:</span>
                                <span id="vector-store-metadata-count" class="status-value">åŠ è½½ä¸­...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ–‡æ¡£ç›‘æ§ç»„ -->
                    <div class="status-group">
                        <div class="status-group-header">
                            <span class="status-group-icon">ğŸ‘ï¸</span>
                            <span>æ–‡æ¡£ç›‘æ§</span>
                        </div>
                        <div class="status-group-content">
                            <div class="status-item">
                                <span class="status-label">æ–‡æ¡£ç›‘æ§çŠ¶æ€:</span>
                                <div id="document-monitor-status" class="status-indicator">
                                    <span class="status-dot"></span>
                                    <span>åŠ è½½ä¸­...</span>
                                </div>
                            </div>
                            <div class="status-item">
                                <span class="status-label">ç›‘æ§æ–‡ä»¶æ•°é‡:</span>
                                <span id="monitored-file-count" class="status-value">åŠ è½½ä¸­...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">æ–‡æ¡£æ›´æ–°é—´éš”:</span>
                                <span id="document-update-interval" class="status-value">åŠ è½½ä¸­...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ¨¡å‹é…ç½®ç»„ -->
                    <div class="status-group">
                        <div class="status-group-header">
                            <span class="status-group-icon">ğŸ¤–</span>
                            <span>æ¨¡å‹é…ç½®</span>
                        </div>
                        <div class="status-group-content">
                            <div class="status-item">
                                <span class="status-label">ä½¿ç”¨çš„æ¨¡å‹:</span>
                                <span id="model-name" class="status-value">åŠ è½½ä¸­...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">æ¨¡å‹æä¾›å•†:</span>
                                <span id="model-provider" class="status-value">åŠ è½½ä¸­...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">åˆ‡æ¢æ¨¡å‹:</span>
                                <div class="model-selector">
                                    <select id="model-select">
                                        <option value="">è¯·é€‰æ‹©æ¨¡å‹</option>
                                    </select>
                                    <button id="switch-model-btn" class="secondary-button" onclick="switchModel()">åˆ‡æ¢æ¨¡å‹</button>
                                </div>
                            </div>
                            <div id="model-switch-status" class="model-switch-status"></div>
                        </div>
                    </div>
                    
                    <!-- æ¨¡å¼é…ç½®ç»„ -->
                    <div class="status-group">
                        <div class="status-group-header">
                            <span class="status-group-icon">ğŸ”„</span>
                            <span>é—®ç­”æ¨¡å¼</span>
                        </div>
                        <div class="status-group-content">
                            <div class="status-item">
                                <span class="status-label">å½“å‰æ¨¡å¼:</span>
                                <span id="current-mode" class="status-value">åŠ è½½ä¸­...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">åˆ‡æ¢æ¨¡å¼:</span>
                                <div class="mode-selector">
                                    <select id="mode-select">
                                        <option value="agent">Agentæ¨¡å¼</option>
                                        <option value="rag">RAGæ¨¡å¼</option>
                                    </select>
                                    <button id="switch-mode-btn" class="secondary-button" onclick="switchMode()">åˆ‡æ¢æ¨¡å¼</button>
                                </div>
                            </div>
                            <div id="mode-switch-status" class="mode-switch-status"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>ä¸ªäººæ™ºèƒ½é—®ç­”æœºå™¨äºº - åŸºäºDeepSeek API+LangChain+æœ¬åœ°æ–‡æ¡£</p>
        </footer>
    </div>
</body>
</html>